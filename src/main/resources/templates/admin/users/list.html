<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{common/layout :: layout(title='관리자 관리', content=~{::content}, scripts=~{::scripts})}">

<th:block th:fragment="content">
  <section class="card">
    <div class="card__header">
      <div>
        <div class="card__title">관리자 목록</div>
        <div class="card__sub muted">추가/수정/삭제</div>
      </div>
      <div class="actions">
        <a class="btn btn--primary" th:href="@{/admin/users/new}">+ 관리자 추가</a>
      </div>
    </div>

    <div class="card__body">
      <div class="toolbar">
        <form th:action="@{/admin/users}" method="get" style="display:flex; gap:10px; align-items:center; width:100%;">
          <input class="input" type="search" placeholder="이름/아이디 검색" id="adminSearch" name="q"
                 th:value="${param.q}" />
          <button class="btn btn--ghost" type="submit">조회</button>
          <button class="btn btn--ghost" type="button" data-admin-refresh>AJAX 조회</button>
        </form>
      </div>

      <div class="table-wrap">
        <table class="table">
          <thead>
          <tr>
            <th>ID</th>
            <th>이름</th>
            <th>권한</th>
            <th>상태</th>
            <th>생성일</th>
            <th style="width:180px;">액션</th>
          </tr>
          </thead>
          <tbody id="adminTbody">
          <tr th:each="a : ${admins}">
            <td th:text="${a.username}">admin</td>
            <td th:text="${a.name}">관리자</td>
            <td><span class="badge" th:text="${a.role}">ROLE_ADMIN</span></td>
            <td th:text="${a.enabled} ? 'ENABLED' : 'DISABLED'">ENABLED</td>
            <td th:text="${a.createdAt != null ? #temporals.format(a.createdAt,'yyyy-MM-dd') : '-'}">-</td>
            <td>
              <a class="btn btn--ghost btn--sm" th:href="@{|/admin/users/${a.id}/edit|}">수정</a>

              <!-- 기본 삭제: POST + _method=DELETE -->
              <form th:action="@{|/admin/users/${a.id}|}" method="post" style="display:inline;">
                <input type="hidden" name="_method" value="delete"/>
                <button class="btn btn--danger btn--sm" type="submit"
                        th:attr="data-delete-admin-id=${a.id}">
                  삭제
                </button>
              </form>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="hint muted">* 목록은 SSR로 기본 동작. 삭제는 form submit으로도 동작. (JS는 있으면 확인 모달/토스트만 추가)</div>
    </div>
  </section>
</th:block>

<th:block th:fragment="scripts">
  <script defer th:src="@{/assets/js/admin-users.js}"></script>
</th:block>
</html>
