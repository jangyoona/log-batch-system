<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{common/layout :: layout(title=${mode=='edit'} ? '게시글 수정' : '게시글 등록', content=~{::content}, scripts=~{::scripts})}">

<th:block th:fragment="content">
    <section class="card">
        <div class="card__header">
            <div>
                <div class="card__title" th:text="${mode=='edit'} ? '게시글 수정' : '게시글 등록'">게시글 등록</div>
            </div>
            <div class="actions">
                <a class="btn btn--ghost" th:href="${mode=='edit'} ? @{|/posts/${post.id}|} : @{/posts/1}">취소</a>
                <button class="btn btn--primary" type="submit" form="postForm">저장</button>
            </div>
        </div>

        <div class="card__body">
            <!-- 기본 동작: 일반 form submit (JS는 있으면 SPA 느낌으로만 향상) -->
            <form id="postForm" class="form"
                  th:action="${mode=='edit'} ? @{|/posts/${post.id}/edit|} : @{/posts/new}"
                  method="post"
                  th:attr="data-mode=${mode}, data-post-id=${post?.id}"
                  autocomplete="off">

                <!-- 수정일 때 PUT 처리: HiddenHttpMethodFilter 사용 -->
                <input th:if="${mode=='edit'}" type="hidden" name="_method" value="put"/>

                <div class="form__row">
                    <label class="label" for="title">제목</label>
                    <input class="input" id="title" name="title" maxlength="100"
                           placeholder="제목을 입력하세요"
                           th:value="${post?.title}" required />
                </div>

                <div class="form__row">
                    <label class="label" for="userName">작성자</label>
                    <input class="input" id="userName" name="userName" maxlength="30"
                           placeholder="작성자"
                           th:value="${session.userName}" readonly />
                </div>

                <div class="form__row">
                    <label class="label" for="content">내용</label>
                    <textarea class="textarea" id="content" name="content" rows="12"
                              placeholder="내용을 입력하세요" required
                              th:text="${post?.content}"></textarea>
                </div>

                <div class="form__row grid two">
                    <div>
                        <label class="label" for="active">상태</label>
                        <select class="select" id="active" name="active">
                            <option value="NORMAL" th:selected="${post?.active == 'NORMAL'}">NORMAL</option>
                            <option value="HIDDEN" th:selected="${post?.active == 'HIDDEN'}">HIDDEN</option>
                        </select>
                    </div>
                </div>

                <div class="hint muted">
                    * 서버가 JSON API를 제공하면 JS(fetch)로 SPA처럼 동작합니다. 제공 안 해도 일반 form submit으로 저장됩니다.
                </div>
            </form>
        </div>
    </section>
</th:block>

<th:block th:fragment="scripts">
    <script defer th:src="@{/assets/js/posts.js}"></script>
</th:block>
</html>
